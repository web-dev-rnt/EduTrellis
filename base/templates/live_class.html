{% load static %}
<!-- Live Classes Section -->
{% if live_classes %}
<div class="course-section">
  <div class="section-header">
    <h2 class="main-heading">Join Live Interactive Classes</h2>
    <p>Learn in real-time with expert educators and get your questions answered instantly</p>
  </div>

  <div class="scroll-row-outer">
    <button class="slide-arrow2 left" onclick="smoothScroll('live-carousel', 'left')" aria-label="Previous">
      <i class="fa fa-chevron-left"></i>
    </button>
    <button class="slide-arrow2 right" onclick="smoothScroll('live-carousel', 'right')" aria-label="Next">
      <i class="fa fa-chevron-right"></i>
    </button>

    <div class="scroll-row" id="live-carousel">
      {% for course in live_classes %}
        <div class="course-card" style="text-decoration: none; color: inherit;">
          
          <div class="course-img"
               style="background-image:url('{% if course.banner_image_desktop %}{{ course.banner_image_desktop.url }}{% else %}{% static 'img/default-live-course.jpg' %}{% endif %}');">
            <div class="live-badge">LIVE</div>
            {% if course.is_free %}
              <div class="free-badge">FREE</div>
            {% endif %}
          </div>
          
          <div class="course-body">
            <a href="{% url 'live_class_detail' pk=course.pk %}" style="text-decoration: none; color: inherit; display: block;">
              <div class="course-title">{{ course.name }}</div>
              
              <div class="course-instructor">Language: {{ course.language_display }}</div>

              <div class="course-pricing">
                {% if course.is_free %}
                  <span class="free-price">FREE</span>
                {% else %}
                  <span class="rupee">₹</span>{{ course.current_price_display }}
                  {% if course.show_price_strike %}
                    <span class="old-price">₹{{ course.original_price_display }}</span>
                  {% endif %}
                {% endif %}
              </div>
              
              {% if course.about_short %}
                <div class="live-description">
                  {{ course.about_short|truncatewords:15 }}
                </div>
              {% endif %}
              
              <div class="live-batch-info">
                <div class="batch-date">
                  <i class="fa fa-calendar"></i> {{ course.start_date|date:"d M Y" }} - {{ course.end_date|date:"d M Y" }}
                </div>
              </div>
              
              {% if course.next_sessions %}
                <div class="live-upcoming">
                  <strong>Upcoming Sessions:</strong>
                  {% for session in course.next_sessions|slice:":2" %}
                    <div class="session-item">
                      <span class="session-date">{{ session.scheduled_datetime|date:"D, d M" }}</span>
                      <span class="session-time">{{ session.scheduled_datetime|time:"g:i a" }}</span>
                    </div>
                  {% endfor %}
                </div>
              {% else %}
                <div class="live-upcoming">
                  <em style="color:#999;">No upcoming sessions</em>
                </div>
              {% endif %}
            </a>
            
            <!-- Button Section - Redirect to Detail Page -->
            <div class="course-labels">
              {% if course.is_purchased %}
                <!-- Already Enrolled - Redirect to detail page -->
                <a href="{% url 'live_class_detail' pk=course.pk %}" class="badge badge-success" style="text-decoration: none; display: inline-block;">
                  <i class="fa fa-check"></i> Access Course
                </a>
              {% elif user.is_authenticated %}
                <!-- Logged In but Not Enrolled - Redirect to detail page to enroll -->
                <a href="{% url 'live_class_detail' pk=course.pk %}" class="badge {% if course.is_free %}badge-free{% else %}badge-live{% endif %}" style="text-decoration: none; display: inline-block;">
                  {% if course.is_free %}
                    <i class="fa fa-check-circle"></i> Enroll Free
                  {% else %}
                    <i class="fa fa-shopping-cart"></i> Enroll Now
                  {% endif %}
                </a>
              {% else %}
                <!-- Not Logged In - Redirect to login -->
                <a href="{% url 'login' %}" class="badge badge-live" style="text-decoration: none; display: inline-block;">
                  <i class="fa fa-sign-in-alt"></i> Login to Enroll
                </a>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
</div>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
// Smooth scrolling functionality
function smoothScroll(carouselId, direction) {
  const carousel = document.getElementById(carouselId);
  if (!carousel) return;
  
  const cardWidth = carousel.querySelector('.course-card')?.offsetWidth;
  if (!cardWidth) return;
  
  const gap = 18;
  const scrollAmount = (cardWidth + gap) * 2;
  const scrollLeft = direction === 'left' ? -scrollAmount : scrollAmount;
  
  carousel.scrollBy({
    left: scrollLeft,
    behavior: 'smooth'
  });
}

// Auto-hide arrows based on scroll position
document.addEventListener('DOMContentLoaded', function() {
  const carousel = document.getElementById('live-carousel');
  if (!carousel) return;
  
  const leftArrow = carousel.parentElement.querySelector('.slide-arrow2.left');
  const rightArrow = carousel.parentElement.querySelector('.slide-arrow2.right');
  
  function updateArrows() {
    if (!leftArrow || !rightArrow) return;
    
    const isAtStart = carousel.scrollLeft <= 10;
    const isAtEnd = carousel.scrollLeft >= carousel.scrollWidth - carousel.clientWidth - 10;
    
    leftArrow.style.opacity = isAtStart ? '0.3' : '0.87';
    leftArrow.style.cursor = isAtStart ? 'default' : 'pointer';
    
    rightArrow.style.opacity = isAtEnd ? '0.3' : '0.87';
    rightArrow.style.cursor = isAtEnd ? 'default' : 'pointer';
  }
  
  carousel.addEventListener('scroll', updateArrows);
  window.addEventListener('resize', updateArrows);
  updateArrows();
});
</script>

<style>
/* Toast Notification */
.toast {
  position: fixed;
  bottom: 20px;
  right: 20px;
  padding: 16px 20px;
  background: #10b981;
  color: white;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  z-index: 9999;
  animation: slideIn 0.3s ease;
  font-weight: 500;
}
.toast.error {
  background: #ef4444;
}
.toast.warning {
  background: #f59e0b;
}
.toast.fade-out {
  animation: slideOut 0.3s ease;
}
@keyframes slideIn {
  from {
    transform: translateX(400px);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}
@keyframes slideOut {
  from {
    transform: translateX(0);
    opacity: 1;
  }
  to {
    transform: translateX(400px);
    opacity: 0;
  }
}

/* Section Header Styles */
.section-header {
  text-align: center;
  margin-bottom: 35px;
  padding: 0 20px;
}

.main-heading {
  font-size: 32px;
  font-weight: 700;
  color: #1a1a1a;
  margin-bottom: 12px;
  line-height: 1.3;
}

.section-description {
  font-size: 16px;
  color: #666;
  max-width: 700px;
  margin: 0 auto;
  line-height: 1.6;
}

/* Live Class Specific Styles */
.live-badge {
  position: absolute;
  top: 12px;
  right: 12px;
  background: linear-gradient(135deg, #ff0844 0%, #ff5478 100%);
  color: #fff;
  padding: 6px 14px;
  border-radius: 20px;
  font-weight: 700;
  font-size: 12px;
  letter-spacing: 0.5px;
  box-shadow: 0 4px 12px rgba(255, 8, 68, 0.3);
  animation: pulse 2s infinite;
}

.free-badge {
  position: absolute;
  top: 12px;
  left: 12px;
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  color: #fff;
  padding: 6px 14px;
  border-radius: 20px;
  font-weight: 700;
  font-size: 12px;
  letter-spacing: 0.5px;
  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.8; }
}

.free-price {
  color: #10b981;
  font-size: 20px;
  font-weight: 800;
  letter-spacing: 0.5px;
}

.live-description {
  font-size: 13px;
  color: #555;
  line-height: 1.5;
  margin: 10px 0;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.live-batch-info {
  margin: 12px 0;
  padding: 8px 0;
  border-top: 1px solid #eee;
}

.batch-date {
  font-size: 13px;
  color: #666;
  display: flex;
  align-items: center;
  gap: 6px;
}

.batch-date i {
  color: #999;
}

.live-upcoming {
  margin: 12px 0;
  font-size: 13px;
}

.live-upcoming strong {
  display: block;
  margin-bottom: 8px;
  color: #333;
  font-size: 14px;
}

.session-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 6px 0;
  border-bottom: 1px solid #f5f5f5;
}

.session-item:last-child {
  border-bottom: none;
}

.session-date {
  color: #8246ef;
  font-weight: 600;
}

.session-time {
  color: #666;
  font-size: 12px;
}

.badge-live {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff;
  padding: 8px 16px;
  border-radius: 6px;
  font-weight: 600;
  font-size: 14px;
  display: inline-block;
  margin-top: 8px;
  transition: all 0.3s ease;
}

.badge-free {
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  color: #fff;
  padding: 8px 16px;
  border-radius: 6px;
  font-weight: 600;
  font-size: 14px;
  display: inline-block;
  margin-top: 8px;
  transition: all 0.3s ease;
}

.badge-success {
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  color: #fff;
  padding: 8px 16px;
  border-radius: 6px;
  font-weight: 600;
  font-size: 14px;
  display: inline-block;
  margin-top: 8px;
  transition: all 0.3s ease;
}

.course-card:hover .badge-live,
.course-card:hover .badge-free,
.course-card:hover .badge-success {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}

/* Course Card Styles */
.course-card {
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  position: relative;
}

.course-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
}

.course-img {
  transition: transform 0.3s ease;
  overflow: hidden;
  border-radius: 8px 8px 0 0;
  position: relative;
}

.course-card:hover .course-img {
  transform: scale(1.05);
}

.slide-arrow2 {
  transition: all 0.3s ease;
}

.slide-arrow2:active {
  transform: translateY(-50%) scale(0.95);
}

.slide-arrow2:hover {
  opacity: 1 !important;
}

/* Responsive Design */
@media (max-width: 768px) {
  .main-heading {
    font-size: 26px;
  }
  
  .section-description {
    font-size: 14px;
  }
  
  .session-item {
    flex-direction: column;
    align-items: flex-start;
    gap: 4px;
  }
  
  .live-description {
    -webkit-line-clamp: 2;
  }
}
</style>
{% endif %}
