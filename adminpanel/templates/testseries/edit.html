{% extends 'admin_dashboard.html' %}

{% block title %}Edit Test Series Course{% endblock %}

{% block content %}
<div class="wrapper">
{% include 'message.html' %}
    <div class="page-header">
        <div class="header-content">
            <h1>Edit Test Series Course</h1>
            <p class="page-subtitle">Update test series course information</p>
        </div>
    </div>

    <div class="nav-buttons">
        <a href="{% url 'test_series_detail' test_series.pk %}" class="btn">← Back to Series Details</a>
    </div>

    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}

        <div class="panel">
            <div class="panel-title">Basic Information</div>

            <label for="title">Test Series Title *</label>
            <p><input type="text" id="title" name="title" value="{{ test_series.title }}" required></p>

            <label for="category">Category *</label>
            <p>
                <select id="category" name="category" required>
                    <option value="">Select Category</option>
                    {% for category in categories %}
                        <option value="{{ category.id }}" {% if test_series.category.id == category.id %}selected{% endif %}>{{ category.name }}</option>
                    {% endfor %}
                </select>
            </p>

            <label for="description">Description *</label>
            <p><textarea id="description" name="description" rows="4" required>{{ test_series.description }}</textarea></p>

            <label for="difficulty">Difficulty Level</label>
            <p>
                <select id="difficulty" name="difficulty">
                    <option value="easy" {% if test_series.difficulty == 'easy' %}selected{% endif %}>Easy</option>
                    <option value="medium" {% if test_series.difficulty == 'medium' %}selected{% endif %}>Medium</option>
                    <option value="hard" {% if test_series.difficulty == 'hard' %}selected{% endif %}>Hard</option>
                    <option value="expert" {% if test_series.difficulty == 'expert' %}selected{% endif %}>Expert</option>
                </select>
            </p>

            <label for="estimated_duration">Estimated Duration</label>
            <p><input type="text" id="estimated_duration" name="estimated_duration" value="{{ test_series.estimated_duration }}"></p>

            <label for="thumbnail">Thumbnail Image</label>
            <p>
                <input type="file" id="thumbnail" name="thumbnail" accept="image/*">
                {% if test_series.thumbnail %}
                    <span class="help-text">Current: {{ test_series.thumbnail.name }}</span>
                {% endif %}
            </p>
        </div>

        <div class="panel">
            <div class="panel-title">Pricing & Features</div>

            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                <input type="checkbox" id="is_free" name="is_free" {% if test_series.is_free %}checked{% endif %} onchange="togglePrice()"> 
                Free Test Series
            </label>

            <p id="price_field">
                <label for="price">Price (₹)</label><br>
                <input type="number" id="price" name="price" step="0.01" min="0" value="{{ test_series.price }}">
            </p>

            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                <input type="checkbox" name="is_featured" {% if test_series.is_featured %}checked{% endif %}> 
                Featured Test Series
            </label>

            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                <input type="checkbox" name="has_negative_marking" {% if test_series.has_negative_marking %}checked{% endif %}> 
                Enable Negative Marking
            </label>

            <label for="negative_marks">Negative Marks</label>
            <p><input type="number" id="negative_marks" name="negative_marks" step="0.01" min="0" value="{{ test_series.negative_marks }}"></p>

            <label for="pass_percentage">Pass Percentage (%)</label>
            <p><input type="number" id="pass_percentage" name="pass_percentage" min="1" max="100" value="{{ test_series.pass_percentage }}"></p>

            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                <input type="checkbox" name="is_active" {% if test_series.is_active %}checked{% endif %}> 
                Test Series is Active
            </label>
        </div>

        <div class="actions">
            <button type="submit" class="btn btn-primary">Update Test Series Course</button>
            <a href="{% url 'test_series_detail' test_series.pk %}" class="btn">Cancel</a>
        </div>
    </form>
</div>

<script>
    function togglePrice() {
        const isFree = document.getElementById('is_free').checked;
        const priceField = document.getElementById('price_field');
        const priceInput = document.getElementById('price');

        if (isFree) {
            priceField.style.display = 'none';
            priceInput.value = '0';
        } else {
            priceField.style.display = 'block';
        }
    }

    // Initialize on load
    togglePrice();
</script>
{% endblock %}
