{% if footer_settings %}
<!-- Dynamic Footer -->
<footer class="footer">
    <div class="footer-inner">
        <div class="footer-logo-col">
            <div class="footer-logo-row">
                {% if footer_settings.logo %}
                    <img src="{{ footer_settings.logo.url }}" alt="Footer Logo" class="footer-logo-img">
                {% else %}
                    {% load static %}
                    <img src="{% static 'img/footerlogo.png' %}" alt="Logo" class="footer-logo-img">
                {% endif %}
            </div>
            
            <div class="footer-mail-row">
                <span class="footer-mail-label">Mail:</span>
                <a href="mailto:{{ footer_settings.email }}" class="footer-mail">{{ footer_settings.email }}</a>
            </div>
            
            <!-- PWA Install Button (replaces app store badges) -->
            <div class="footer-install-container">
                <button id="footer-install-pwa-btn" class="footer-install-btn">
                    <i class="fa fa-download"></i>
                    <span>Install Our App</span>
                </button>
                <p class="footer-install-description">Get instant access to all courses offline!</p>
            </div>
            
            <!-- Social Media Links -->
            <div class="footer-social-row">
                {% if footer_settings.facebook_url %}
                    <a href="{{ footer_settings.facebook_url }}" class="footer-social social-facebook" title="Facebook" target="_blank" rel="noopener noreferrer">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                {% endif %}
                {% if footer_settings.twitter_url %}
                    <a href="{{ footer_settings.twitter_url }}" class="footer-social social-twitter" title="Twitter" target="_blank" rel="noopener noreferrer">
                        <i class="fab fa-twitter"></i>
                    </a>
                {% endif %}
                {% if footer_settings.youtube_url %}
                    <a href="{{ footer_settings.youtube_url }}" class="footer-social social-youtube" title="YouTube" target="_blank" rel="noopener noreferrer">
                        <i class="fab fa-youtube"></i>
                    </a>
                {% endif %}
                {% if footer_settings.linkedin_url %}
                    <a href="{{ footer_settings.linkedin_url }}" class="footer-social social-linkedin" title="LinkedIn" target="_blank" rel="noopener noreferrer">
                        <i class="fab fa-linkedin-in"></i>
                    </a>
                {% endif %}
                {% if footer_settings.instagram_url %}
                    <a href="{{ footer_settings.instagram_url }}" class="footer-social social-instagram" title="Instagram" target="_blank" rel="noopener noreferrer">
                        <i class="fab fa-instagram"></i>
                    </a>
                {% endif %}
                {% if footer_settings.telegram_url %}
                    <a href="{{ footer_settings.telegram_url }}" class="footer-social social-telegram" title="Telegram" target="_blank" rel="noopener noreferrer">
                        <i class="fab fa-telegram-plane"></i>
                    </a>
                {% endif %}
                {% if footer_settings.whatsapp_url %}
                    <a href="{{ footer_settings.whatsapp_url }}" class="footer-social social-whatsapp" title="WhatsApp" target="_blank" rel="noopener noreferrer">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                {% endif %}
            </div>
        </div>
        
        <!-- Dynamic Footer Links by Section -->
        {% for section_key, section_name in footer_sections %}
            <div class="footer-links-col">
                <h4>{{ section_name }}</h4>
                {% for link in footer_links %}
                    {% if link.section == section_key %}
                        <a class="footer-link" href="{{ link.url }}">{{ link.title }}</a>
                    {% endif %}
                {% endfor %}
                
                <!-- Special handling for Business section language selector -->
                {% if section_key == 'business' %}
                    <div class="footer-language">
                        <select class="footer-selectbox" aria-label="Select Language">
                            <option>English</option>
                            <option>Hindi</option>
                        </select>
                    </div>
                {% endif %}
            </div>
        {% endfor %}
    </div>
    
    <div class="footer-legal">
        {{ footer_settings.copyright_text }}
        {% if footer_legal_links %}
            {% for legal_link in footer_legal_links %}
                <span class="footer-dot">&bull;</span>
                <a href="{{ legal_link.url }}">{{ legal_link.title }}</a>
            {% endfor %}
        {% endif %}
    </div>
</footer>

<style>
/* Footer styles */
.footer {
    background: #1b1c22;
    color: #b8bac3;
    font-size: 16px;
    letter-spacing: 0;
    padding: 43px 0 12px 0;
}

.footer-inner {
    max-width: 1320px;
    margin: 0 auto 0 auto;
    display: flex;
    flex-wrap: wrap;
    gap: 26px 12px;
    justify-content: space-between;
    align-items: flex-start;
    padding: 0 40px;
}

.footer-logo-row {
    display: flex;
    align-items: flex-end;
    gap: 6px;
    margin-bottom: 7px;
}

.footer-logo-img {
    height: 65px;
}

.footer-logo-text {
    color: #fff;
    font-weight: 700;
    font-size: 1.27em;
    letter-spacing: 1px;
}

.footer-mail-row {
    margin-bottom: 16px;
}

.footer-mail-label {
    color: #ffd067;
    font-weight: 600;
    margin-right: 4px;
}

.footer-mail {
    color: #e8e8e8;
    text-decoration: none;
    font-size: 1em;
    transition: color 0.3s ease;
}

.footer-mail:hover {
    color: #ffd067;
    text-decoration: none;
}

/* PWA Install Button in Footer */
.footer-install-container {
    margin: 18px 0 14px 0;
}

.footer-install-btn {
    background: linear-gradient(135deg, #c7212f 0%, #a01b27 100%);
    color: #ffffff;
    border: none;
    padding: 12px 24px;
    border-radius: 25px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(199, 33, 47, 0.3);
    font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    width: fit-content;
    margin-bottom: 8px;
}

.footer-install-btn i {
    font-size: 16px;
}

.footer-install-btn:hover {
    background: linear-gradient(135deg, #a01b27 0%, #8a1722 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(199, 33, 47, 0.4);
}

.footer-install-btn:active {
    transform: translateY(0);
}

.footer-install-description {
    color: #b8bac3;
    font-size: 13px;
    margin: 0;
    opacity: 0.85;
    line-height: 1.4;
}

.footer-social-row {
    display: flex;
    gap: 13px;
    margin-top: 18px;
}

.footer-social {
    color: #fff;
    opacity: 0.9;
    font-size: 1.2em;
    transition: color 0.18s, opacity 0.14s, transform 0.3s;
    background: #252628;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
}

.footer-social i {
    vertical-align: middle;
    font-size: 18px;
}

.footer-social:hover {
    color: #fff;
    opacity: 1;
    transform: translateY(-3px);
}

/* Social Media Brand Colors */
.social-facebook { background: #3b5998; }
.social-twitter { background: #1da1f2; }
.social-youtube { background: #ff0000; }
.social-linkedin { background: #0077b5; }
.social-instagram {
    background: radial-gradient(circle at 30% 107%, #fdf497 0%, #fdf497 5%, #fd5949 45%, #d6249f 60%, #285AEB 90%);
    color: #fff;
}
.social-telegram { background: #0088cc; }
.social-whatsapp { background: #25d366; }

.footer-social:hover.social-facebook { background: #2d4373; }
.footer-social:hover.social-twitter { background: #1a8cd8; }
.footer-social:hover.social-youtube { background: #cc0000; }
.footer-social:hover.social-linkedin { background: #005582; }
.footer-social:hover.social-instagram { background: #c13584; }
.footer-social:hover.social-telegram { background: #0077b5; }
.footer-social:hover.social-whatsapp { background: #128c7e; }

.footer-links-col {
    min-width: 158px;
    line-height: 1.6;
}

.footer-links-col h4 {
    color: #ffd067;
    font-weight: 700;
    margin: 0 0 12px 0;
    text-transform: uppercase;
    font-size: 16.9px;
    letter-spacing: .4px;
}

.footer-link {
    color: #e8e8e8;
    text-decoration: none;
    display: block;
    margin-bottom: 6px;
    font-size: 1em;
    opacity: 0.88;
}

.footer-link:hover {
    color: #ffd067;
    opacity: 1;
    text-decoration: underline;
}

.footer-language {
    margin-top: 11px;
}

.footer-selectbox {
    background: #15161b;
    border-radius: 7px;
    color: #f7de9c;
    padding: 6px 14px;
    font-size: 1em;
    border: 1px solid #383939;
    cursor: pointer;
}

.footer-legal {
    text-align: center;
    border-top: 1px solid #2e2f34;
    margin-top: 34px;
    font-size: 0.97em;
    color: #7c8696;
    padding: 14px 0 6px 0;
    letter-spacing: 0.04em;
}

.footer-legal a {
    color: #ffe093;
    margin: 0 7px;
    text-decoration: none;
    font-size: 0.9em;
    opacity: 0.91;
}

.footer-legal a:hover {
    color: #ffd067;
}

.footer-dot {
    font-size: 15px;
    color: #50535a;
    margin: 0 5px;
}

/* Tablet & Mobile Responsive */
@media (max-width: 900px) {
    .footer-inner {
        flex-direction: column;
        gap: 23px;
    }
    
    .footer-logo-col,
    .footer-links-col {
        min-width: 0;
    }
    
    .footer-install-btn {
        width: 100%;
        justify-content: center;
        max-width: 300px;
    }
}

@media (max-width: 480px) {
    .footer-inner {
        padding: 0 20px;
    }
    
    .footer-logo-img {
        height: 50px;
    }
    
    .footer-install-btn {
        padding: 11px 20px;
        font-size: 14px;
    }
    
    .footer-install-btn i {
        font-size: 14px;
    }
    
    .footer-install-description {
        font-size: 12px;
    }
    
    .footer-social {
        width: 36px;
        height: 36px;
    }
    
    .footer-social i {
        font-size: 16px;
    }
}

@media (max-width: 360px) {
    .footer-inner {
        padding: 0 15px;
    }
    
    .footer-logo-img {
        height: 45px;
    }
    
    .footer-install-btn {
        padding: 10px 18px;
        font-size: 13px;
    }
    
    .footer-install-btn i {
        font-size: 13px;
    }
}
</style>

<!-- Footer PWA Install Script (Self-contained) -->
<script>
(function() {
  'use strict';
  
  // Wait for DOM to be fully loaded
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initFooterPWA);
  } else {
    initFooterPWA();
  }
  
  function initFooterPWA() {
    const footerInstallBtn = document.getElementById('footer-install-pwa-btn');
    
    if (!footerInstallBtn) {
      console.log('‚ö†Ô∏è Footer install button not found');
      return;
    }
    
    console.log('üöÄ Footer PWA handler initialized');
    
    let footerDeferredPrompt = null;
    
    // Check if app is already installed
    function isAppInstalled() {
      return window.matchMedia('(display-mode: standalone)').matches || 
             window.navigator.standalone === true;
    }
    
    // Detect iOS
    function isIOS() {
      return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
    }
    
    // Listen for beforeinstallprompt event
    window.addEventListener('beforeinstallprompt', (event) => {
      console.log('üí° Footer: beforeinstallprompt event fired');
      
      // Prevent default
      event.preventDefault();
      
      // Save the event
      footerDeferredPrompt = event;
      
      // Show button if app not installed
      if (!isAppInstalled()) {
        footerInstallBtn.style.display = 'flex';
        console.log('‚úÖ Footer install button shown');
      }
    });
    
    // Handle footer install button click
    footerInstallBtn.addEventListener('click', async function(e) {
      e.preventDefault();
      e.stopPropagation();
      
      console.log('üñ±Ô∏è Footer install button clicked');
      
      if (!footerDeferredPrompt) {
        console.log('‚ùå Footer: deferredPrompt is NULL');
        
        // Show helpful message
        if (isIOS()) {
          alert('To install on iOS:\n\n1. Tap the Share button (‚¨ÜÔ∏è)\n2. Select "Add to Home Screen"\n3. Tap "Add"');
        } else {
          alert('Installation not available:\n\n‚Ä¢ Use Chrome, Edge, or Samsung Internet on Android\n‚Ä¢ Make sure you are on HTTPS\n‚Ä¢ Clear cache and reload if needed');
        }
        return;
      }
      
      console.log('‚úÖ Showing install prompt...');
      
      // Hide button temporarily
      footerInstallBtn.style.display = 'none';
      
      try {
        // Show the install prompt
        await footerDeferredPrompt.prompt();
        
        // Wait for user response
        const { outcome } = await footerDeferredPrompt.userChoice;
        console.log(`üë§ Footer: User response: ${outcome}`);
        
        if (outcome === 'accepted') {
          console.log('‚úÖ User accepted installation from footer');
          
          // Track in analytics if available
          if (typeof gtag !== 'undefined') {
            gtag('event', 'pwa_installed_footer', {
              'event_category': 'PWA',
              'event_label': 'Installed from Footer'
            });
          }
        } else {
          console.log('‚ùå User dismissed installation');
          
          // Show button again after 3 seconds
          setTimeout(function() {
            if (!isAppInstalled()) {
              footerInstallBtn.style.display = 'flex';
              console.log('üîÑ Footer button shown again');
            }
          }, 3000);
        }
      } catch (error) {
        console.error('‚ùå Installation error:', error);
      }
      
      // Clear deferred prompt
      footerDeferredPrompt = null;
    });
    
    // Handle app installed event
    window.addEventListener('appinstalled', function(event) {
      console.log('üéâ Footer: PWA installed successfully!');
      
      // Hide button
      footerInstallBtn.style.display = 'none';
      
      // Clear deferred prompt
      footerDeferredPrompt = null;
      
      // Show success message
      setTimeout(function() {
        alert('üéâ App installed successfully! You can now access EduTrellis from your home screen.');
      }, 500);
    });
    
    // Hide button if app already installed
    if (isAppInstalled()) {
      footerInstallBtn.style.display = 'none';
      console.log('‚úÖ Footer: App already installed - button hidden');
    }
    
    // For testing on localhost - show button immediately
    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
      setTimeout(function() {
        if (!isAppInstalled() && footerInstallBtn) {
          footerInstallBtn.style.display = 'flex';
          console.log('üß™ Test mode: Footer button shown');
        }
      }, 1000);
    }
  }
})();
</script>
{% endif %}
