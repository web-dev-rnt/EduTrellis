{% extends 'base.html' %}
{% load static %}

{% block title %}My Purchases - {{ block.super }}{% endblock %}

{% block content %}
<style>
    .purchases-container {
        max-width: 1200px;
        margin: 40px auto;
        padding: 0 20px;
    }

    .section-title {
        font-size: 16px;
        font-weight: 400;
        color: #333;
        margin: 40px 0 20px 0;
        padding-bottom: 12px;
        border-bottom: 1px solid #ddd;
        display: inline-block;
        letter-spacing: 0.3px;
    }

    .purchase-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 24px;
        margin-bottom: 40px;
    }

    .purchase-card {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
        border: 2px solid transparent;
    }

    .purchase-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        border-color: #c7212f;
    }

    .purchase-thumbnail {
        width: 100%;
        height: 180px;
        object-fit: cover;
        background: linear-gradient(135deg, #f5f7fa 0%, #e8eef5 100%);
    }

    .purchase-content {
        padding: 20px;
    }

    .purchase-type-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        margin-bottom: 10px;
    }

    .badge-video {
        background: #e3f2fd;
        color: #1976d2;
    }

    .badge-live {
        background: #fff3e0;
        color: #f57c00;
    }

    .badge-test {
        background: #e8f5e9;
        color: #388e3c;
    }

    .badge-elibrary {
        background: #f3e5f5;
        color: #7b1fa2;
    }

    .badge-bundle {
        background: #fff9c4;
        color: #f57f17;
    }

    .purchase-title {
        font-size: 18px;
        font-weight: 700;
        color: #333;
        margin: 0 0 12px 0;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .purchase-meta {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-bottom: 16px;
        font-size: 14px;
        color: #666;
    }

    .meta-row {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .meta-row i {
        width: 16px;
        color: #999;
    }

    .purchase-actions {
        display: flex;
        gap: 10px;
    }

    .btn-access {
        flex: 1;
        padding: 12px;
        background: #c7212f;
        color: white;
        text-align: center;
        text-decoration: none;
        border-radius: 8px;
        font-weight: 600;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
    }

    .btn-access:hover {
        background: #a01a26;
        transform: scale(1.02);
        box-shadow: 0 4px 12px rgba(199, 33, 47, 0.3);
    }

    .btn-access:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #999;
    }

    .empty-state i {
        font-size: 64px;
        margin-bottom: 20px;
        opacity: 0.5;
    }

    .empty-state h3 {
        font-size: 24px;
        margin-bottom: 10px;
        color: #666;
    }

    .empty-state p {
        font-size: 16px;
        margin-bottom: 20px;
    }

    .btn-browse {
        display: inline-block;
        padding: 12px 30px;
        background: #c7212f;
        color: white;
        text-decoration: none;
        border-radius: 8px;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .btn-browse:hover {
        background: #a01a26;
        transform: scale(1.05);
    }

    .expires-warning {
        display: inline-block;
        padding: 4px 10px;
        background: #fff3cd;
        color: #856404;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 600;
        margin-top: 8px;
        margin-bottom: 5px;
    }

    .price-paid {
        font-size: 20px;
        font-weight: 700;
        color: #c7212f;
        margin-top: 8px;
        margin-bottom: 5px;
    }

    @media (max-width: 768px) {
        .purchase-grid {
            grid-template-columns: 1fr;
        }
    }
</style>

<div class="purchases-container">
    <!-- Video Courses -->
    {% if purchases.video_courses %}
    <h2 class="section-title"><i class="fa fa-video-camera"></i> Video Courses</h2>
    <div class="purchase-grid">
        {% for item in purchases.video_courses %}
        <div class="purchase-card">
            {% if item.course.thumbnail %}
                <img src="{{ item.course.thumbnail.url }}" alt="{{ item.course.name }}" class="purchase-thumbnail">
            {% else %}
                <div class="purchase-thumbnail" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></div>
            {% endif %}
            <div class="purchase-content">
                <span class="purchase-type-badge badge-video">Video Course</span>
                <h3 class="purchase-title">{{ item.course.name|default:"Video Course" }}</h3>
                <div class="purchase-meta">
                    <div class="meta-row">
                        <i class="fa fa-calendar"></i>
                        <span>Purchased: {{ item.access_granted|date:"d M, Y" }}</span>
                    </div>
                    {% if item.payment %}
                    <div class="meta-row">
                        <i class="fa fa-credit-card"></i>
                        <span>Order ID: {{ item.payment.razorpay_order_id|truncatechars:20 }}</span>
                    </div>
                    {% endif %}
                </div>
                {% if item.course.is_free %}
                    <div class="price-paid" style="color: #10b981;">FREE</div>
                {% else %}
                    <div class="price-paid">₹{{ item.course.selling_price|floatformat:2 }}</div>
                {% endif %}
                {% if item.expires_at %}
                <div class="expires-warning">
                    <i class="fa fa-clock-o"></i> Expires: {{ item.expires_at|date:"d M, Y" }}
                </div>
                {% endif %}
                <div class="purchase-actions">
                    <a href="{% url 'video_course_detail' pk=item.course.id %}" class="btn-access">
                        <i class="fa fa-play-circle"></i> Access Course
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Live Classes -->
    {% if purchases.live_classes %}
    <h2 class="section-title"><i class="fa fa-television"></i> Live Classes</h2>
    <div class="purchase-grid">
        {% for item in purchases.live_classes %}
        <div class="purchase-card">
            {% if item.course.banner_image_desktop %}
                <img src="{{ item.course.banner_image_desktop.url }}" alt="{{ item.course.name }}" class="purchase-thumbnail">
            {% elif item.course.banner_image_mobile %}
                <img src="{{ item.course.banner_image_mobile.url }}" alt="{{ item.course.name }}" class="purchase-thumbnail">
            {% else %}
                <div class="purchase-thumbnail" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"></div>
            {% endif %}
            <div class="purchase-content">
                <span class="purchase-type-badge badge-live">Live Class</span>
                <h3 class="purchase-title">{{ item.course.name|default:"Live Class" }}</h3>
                <div class="purchase-meta">
                    <div class="meta-row">
                        <i class="fa fa-calendar"></i>
                        <span>Purchased: {{ item.access_granted|date:"d M, Y" }}</span>
                    </div>
                    {% if item.payment %}
                    <div class="meta-row">
                        <i class="fa fa-credit-card"></i>
                        <span>Order ID: {{ item.payment.razorpay_order_id|truncatechars:20 }}</span>
                    </div>
                    {% endif %}
                    <div class="meta-row">
                        <i class="fa fa-language"></i>
                        <span>{{ item.course.language }}</span>
                    </div>
                </div>
                {% if item.course.is_free %}
                    <div class="price-paid" style="color: #10b981;">FREE</div>
                {% else %}
                    <div class="price-paid">₹{{ item.course.current_price|floatformat:2 }}</div>
                {% endif %}
                {% if item.expires_at %}
                <div class="expires-warning">
                    <i class="fa fa-clock-o"></i> Expires: {{ item.expires_at|date:"d M, Y" }}
                </div>
                {% endif %}
                <div class="purchase-actions">
                    <a href="{% url 'live_class_detail' pk=item.course.id %}" class="btn-access">
                        <i class="fa fa-play-circle"></i> Access Class
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Test Series -->
    {% if purchases.test_series %}
    <h2 class="section-title"><i class="fa fa-file-text"></i> Test Series</h2>
    <div class="purchase-grid">
        {% for item in purchases.test_series %}
        <div class="purchase-card">
            {% if item.course.thumbnail %}
                <img src="{{ item.course.thumbnail.url }}" alt="{{ item.course.title }}" class="purchase-thumbnail">
            {% else %}
                <div class="purchase-thumbnail" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);"></div>
            {% endif %}
            <div class="purchase-content">
                <span class="purchase-type-badge badge-test">Test Series</span>
                <h3 class="purchase-title">{{ item.course.title|default:"Test Series" }}</h3>
                <div class="purchase-meta">
                    <div class="meta-row">
                        <i class="fa fa-calendar"></i>
                        <span>Purchased: {{ item.access_granted|date:"d M, Y" }}</span>
                    </div>
                    {% if item.payment %}
                    <div class="meta-row">
                        <i class="fa fa-credit-card"></i>
                        <span>Order ID: {{ item.payment.razorpay_order_id|truncatechars:20 }}</span>
                    </div>
                    {% endif %}
                </div>
                {% if item.course.is_free %}
                    <div class="price-paid" style="color: #10b981;">FREE</div>
                {% else %}
                    <div class="price-paid">₹{{ item.course.price|floatformat:2 }}</div>
                {% endif %}
                {% if item.expires_at %}
                <div class="expires-warning">
                    <i class="fa fa-clock-o"></i> Expires: {{ item.expires_at|date:"d M, Y" }}
                </div>
                {% endif %}
                <div class="purchase-actions">
                    <a href="{% url 'front_exam_series_detail' pk=item.course.id %}" class="btn-access">
                        <i class="fa fa-pencil"></i> Start Tests
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- E-Library -->
    {% if purchases.elibrary_courses %}
    <h2 class="section-title"><i class="fa fa-book"></i> E-Library</h2>
    <div class="purchase-grid">
        {% for item in purchases.elibrary_courses %}
        <div class="purchase-card">
            {% if item.course.cover_image %}
                <img src="{{ item.course.cover_image.url }}" alt="{{ item.course.title }}" class="purchase-thumbnail">
            {% else %}
                <div class="purchase-thumbnail" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);"></div>
            {% endif %}
            <div class="purchase-content">
                <span class="purchase-type-badge badge-elibrary">E-Library</span>
                <h3 class="purchase-title">{{ item.course.title|default:"E-Library Course" }}</h3>
                <div class="purchase-meta">
                    <div class="meta-row">
                        <i class="fa fa-calendar"></i>
                        <span>Purchased: {{ item.access_granted|date:"d M, Y" }}</span>
                    </div>
                    {% if item.payment %}
                    <div class="meta-row">
                        <i class="fa fa-credit-card"></i>
                        <span>Order ID: {{ item.payment.razorpay_order_id|truncatechars:20 }}</span>
                    </div>
                    {% endif %}
                </div>
                <div class="price-paid">₹{{ item.course.current_price|floatformat:2 }}</div>
                {% if item.expires_at %}
                <div class="expires-warning">
                    <i class="fa fa-clock-o"></i> Expires: {{ item.expires_at|date:"d M, Y" }}
                </div>
                {% endif %}
                <div class="purchase-actions">
                    <a href="{% url 'course_detail' pk=item.course.id %}" class="btn-access">
                        <i class="fa fa-book"></i> Access Library
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Bundles -->
    {% if purchases.bundles %}
    <h2 class="section-title"><i class="fa fa-gift"></i> Product Bundles</h2>
    <div class="purchase-grid">
        {% for item in purchases.bundles %}
        <div class="purchase-card">
            {% if item.course.thumbnail %}
                <img src="{{ item.course.thumbnail.url }}" alt="{{ item.course.title }}" class="purchase-thumbnail">
            {% elif item.course.banner_image %}
                <img src="{{ item.course.banner_image.url }}" alt="{{ item.course.title }}" class="purchase-thumbnail">
            {% else %}
                <div class="purchase-thumbnail" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);"></div>
            {% endif %}
            <div class="purchase-content">
                <span class="purchase-type-badge badge-bundle">Bundle</span>
                <h3 class="purchase-title">{{ item.course.title|default:"Product Bundle" }}</h3>
                <div class="purchase-meta">
                    <div class="meta-row">
                        <i class="fa fa-calendar"></i>
                        <span>Purchased: {{ item.access_granted|date:"d M, Y" }}</span>
                    </div>
                    {% if item.payment %}
                    <div class="meta-row">
                        <i class="fa fa-credit-card"></i>
                        <span>Order ID: {{ item.payment.razorpay_order_id|truncatechars:20 }}</span>
                    </div>
                    {% endif %}
                    <div class="meta-row">
                        <i class="fa fa-box"></i>
                        <span>{{ item.course.total_products }} Products Included</span>
                    </div>
                </div>
                {% if item.course.bundle_price == 0 %}
                    <div class="price-paid" style="color: #10b981;">FREE</div>
                {% else %}
                    <div class="price-paid">₹{{ item.course.bundle_price|floatformat:2 }}</div>
                {% endif %}
                {% if item.expires_at %}
                <div class="expires-warning">
                    <i class="fa fa-clock-o"></i> Expires: {{ item.expires_at|date:"d M, Y" }}
                </div>
                {% endif %}
                <div class="purchase-actions">
                    <a href="{% url 'product_bundle_detail' slug=item.course.slug %}" class="btn-access">
                        <i class="fa fa-gift"></i> View Bundle
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Empty State -->
    {% if total_purchases == 0 %}
    <div class="empty-state">
        <i class="fa fa-shopping-cart"></i>
        <h3>No Purchases Yet</h3>
        <p>Start your learning journey by exploring our courses</p>
        <a href="{% url 'home' %}" class="btn-browse">
            <i class="fa fa-search"></i> Browse Courses
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}